cameras:
    camera1:
        type: perspective
        focal_length: [[16, 2], [20, 6]] # pairs of [zoom, focal len]
        vanishing_point: [0, -500] # relative to center of screen, in pixels

lights:
    key:
        type: directional
        direction: [-.2, 1, -.9]
        diffuse: .6
        ambient: .8

    spec:
        type: point
        diffuse: 0
        specular: .00000001
        position: [0, 0, 300px]
        origin: ground


sources:
    osm:
        type: GeoJSONTileSource
        url:  http://vector.mapzen.com/osm/all/{z}/{x}/{y}.json

styles:
    text:
        selection: true

    ripples:
        extends: polygons
        animated: true
        material:
            diffuse: 1
            specular: 1
            shininess: 8
        shaders:
            transforms:
                globals:
                    url: shaders/glsl-noise-periodic-3d.glsl
                # normal: |
                #     normal += (abs(pnoise((v_world_position.xyz + vec3(u_time * 5., u_time * 7.5, u_time * 10.)) / 20.0, vec3(100000. / 10.0))) / 4.0) + 0.75;

    basic_buildings:
        extends: polygons
        shaders:
            transforms:
                color: |
                    color.rgb *= vec3(min((v_world_position.z/1000. + .6), .7)); // slight fade with height
                    //color.rgb += vec3(.07, .06, .05); // brighten and tint slightly
                    color.rgb += vec3(.15, .12, .10); // brighten and tint slightly

    elevator:
        extends: polygons
        animated: true
        shaders:
            transforms:
                position: |
                    // Elevator buildings
                    if (position.z > 0.01) {
                        position.z *= (sin(position.z + u_time) + 1.0);
                    }

    colorhalftone:
        url: styles/halftone.yaml

    windows:
        url: styles/windows.yaml                    

layers:
    earth:
        geometry:
            source: osm
            filter: earth
        style:
            order: 0
            color: '#d3d3cc'

    landuse:
        geometry:
            source: osm
            filter: landuse
        filter:
            name: true
        style:
            order: 1
            color: '#bbffbb'
            interactive: true

    water:
        geometry:
            source: osm
            filter: water
        style:
            name: ripples
            order: 2
            color: '#99ccff'

    roads:
        geometry:
            source: osm
            filter: roads
        style:
            interactive: true
            order: 3
            color: '#bbbbbb'
            width: 8
            outline:
                width: 0
                color: grey
        highway:
            filter: { kind: highway, is_link: no }
            style:
                order: .5
                color: '#cc6666'
                width: [[10, 2px], [13, 3px], [15, 4px], [16, 8px], [18, 20px]]
                outline:
                    width: [[9, .25px], [15, 1px], [19, 2px]]
        tunnel:
            filter:
                is_tunnel: yes
            style:
                color: tan
        major_road:
            filter:
                kind: major_road
            style:
                width: [[8, 0px], [12, 1.5px], [15, 2.5px], [16, 4px], [17, 7px], [18, 15px]]
        minor_road:
            filter: { kind: minor_road }
            # filter: { kind: minor_road, not: { aeroway: [taxiway, runway] } }
            style:
                width: [[10, 0px], [12, .25px], [13, .5px], [15, 3px], [17, 5px]]
        path:
            filter:
                kind: path
            style:
                width: 0
        rail:
            filter:
                kind: rail
                is_tunnel: no
            style:
                color: pink
                width: 3
        subway:
            filter:
                railway: subway
            style:
                color: red
                width: 0
    
        airports:
            filter: { aeroway: true }
            style:
                color: [.68, .67, .65]
            taxiways:
                filter: { aeroway: taxiway }
                style:
                    width: [[12, 1px], [13, 2px], [17, 10px]]
                    cap: round

            runways:
                filter: { aeroway: runway }
                style:
                    width: [[12, 5px], [13, 10px], [15, 20px], [17, 100px]]
                    order: .1

    buildings:
        geometry:
            source: osm
            filter: buildings
        style:
            interactive: true
            name: basic_buildings
            order: 4
            color: white
            extrude: function () { return (zoom >= 15) } 
        colors:
            filter: { name: true }
            style:
                color: [[12, [1, 1, 1]], [14,[1., .6, .6]]]

    labels_street:
        geometry:
            source: osm
            filter: roads

        filter: { name: true, railway: false, $zoom: { min: 14 } }
        style:
            name: text
            order: 5
            interactive: true
            font:
                typeface: Arial
                size: 24px
                fill: black
                stroke: white
                stroke_width: 3

        # major_road:
        #     filter: { kind: major_road, $zoom: { min: 14 } }
        # minor_road:
        #     filter: { kind: minor_road, $zoom: { min: 15 } }


    places:
        geometry: { source: osm, filter: places }
        filter: { name: true }

        style:
            name: text
            order: 6
            font:
                size: 32px
                typeface: Arial
                fill: black
                stroke: white
